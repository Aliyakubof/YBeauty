<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>YBeauty</title>

<!-- ====== STYLE ====== -->
<style>
  :root{
    --pink:#ff69b4;
    --pink-200:#ffe4e9;
    --pink-300:#ffb6c1;
    --ink:#333;
    --card-shadow:0 6px 18px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,"Segoe UI",Arial; color:var(--ink);background:#fff}
  
  /* Header */
  .header{
    background:var(--pink-300);
    padding:10px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    position:sticky;
    top:0;
    z-index:20;
  }
  .logo{color:#fff;font-weight:700;font-size:22px;letter-spacing:.3px}
  .header-left{
    display:flex;
    align-items:center;
    gap:8px;
    flex:1;
  }
  .searchbar{
    display:flex;align-items:center;gap:8px;
    background:#fff;border-radius:999px;
    padding:6px 10px;
    min-width:0;
    flex:1;
    box-shadow:var(--card-shadow);
  }
  .searchbar input{border:none;outline:none;font-size:14px;flex:1;background:transparent}
  .icon-btn{
    border:none;
    background:var(--pink);
    cursor:pointer;
    font-size:20px;
    line-height:1;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    transition:.15s transform, .15s background, .15s color;
    border-radius:8px;
    padding:6px 10px;
    color:#fff;
  }
  .icon-btn:hover{background:#ff85c1}
  .icon-btn:active{transform:scale(.95)}

  /* Navbar */
  .navbar{
    background:var(--pink-200);
    display:flex;
    gap:18px;
    justify-content:center;
    align-items:center;
    padding:10px 8px;
    flex-wrap:wrap;
    position:sticky;
    top:56px;
    z-index:19;
  }
  .nav-link{
    border:none;
    background:transparent;
    color:var(--pink);
    font-weight:600;
    cursor:pointer;
    padding:6px 12px;
    border-radius:8px;
    transition:.15s background;
    min-width:100px;
    text-align:center;
  }
  .nav-link.active,.nav-link:hover{background:#fff}

  /* Sections */
  .section{display:none;padding:18px;max-width:1100px;margin:0 auto}
  .section.active{display:block}

  /* Slider */
  .slider{position:relative;border-radius:14px;overflow:hidden;height:240px;margin-bottom:18px;box-shadow:var(--card-shadow)}
  .slides{display:flex;width:100%;height:100%;transition:transform .6s ease}
  .slides img{width:100%;height:100%;object-fit:cover;flex:1 0 100%}

  /* Mini-cards scroller */
  .mini{display:flex;gap:12px;overflow:auto;padding:6px 2px 10px}
  .mini::-webkit-scrollbar{display:none}
  .mini .card{min-width:150px}

  /* Grid cards */
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media(min-width:720px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
  .card{background:#fff;border-radius:14px;box-shadow:var(--card-shadow);overflow:hidden;cursor:pointer;transition:.18s transform}
  .card:active{transform:scale(.98)}
  .card img{width:100%;height:160px;object-fit:cover;display:block}
  .card .body{padding:10px}
  .title{font-size:14px;font-weight:600;margin:0 0 6px}
  .price{color:var(--pink);font-weight:700}
  h3.section-title{margin:8px 0 10px}

  /* Modal (product) */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
  .modal.open{display:flex}
  .modal-card{background:#fff;border-radius:18px;max-width:520px;width:100%;box-shadow:var(--card-shadow);overflow:hidden}
  .modal-media{width:100%;height:260px;object-fit:cover}
  .modal-body{padding:16px}
  .muted{color:#666;font-size:14px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px}

  /* Buttons */
  .btn{border:none;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700}
  .btn-primary{background:var(--pink);color:#fff}
  .btn-outline{background:#fff;border:2px solid var(--pink);color:var(--pink)}

  /* Order form inside modal */
  .form{display:grid;gap:10px;margin-top:12px}
  .input{width:100%;padding:10px 12px;border:1px solid #e7e7e7;border-radius:8px;font-size:14px}

  /* Admin */
  .admin-wrap{display:grid;gap:10px;overflow-x:auto}
  table{width:100%;border-collapse:collapse;border-radius:12px;overflow:hidden;box-shadow:var(--card-shadow);min-width:600px}
  th,td{padding:10px 8px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
  th{background:var(--pink-300);color:#fff}
  tr:last-child td{border-bottom:none}
  .pill{display:inline-block;background:#fff;color:#b30059;border:1px solid #ff99cc;padding:2px 8px;border-radius:999px;font-size:12px}

  /* Stats */
  .stats{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px}
  .stat{flex:1;min-width:140px;background:var(--pink-200);padding:10px;border-radius:12px;text-align:center;box-shadow:var(--card-shadow)}
  .stat h4{margin:0;font-size:14px;color:#444}
  .stat p{margin:6px 0 0;font-weight:700;color:var(--pink)}

  /* Back button */
  .back-btn{
    display:flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
    font-weight:600;
    color:var(--pink);
    margin-bottom:12px;
  }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
  import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBW6PoZ2TMbkHqetNiLt0rUivdgbsM6ivs",
    authDomain: "ybeauty-f45b6.firebaseapp.com",
    databaseURL: "https://ybeauty-f45b6-default-rtdb.firebaseio.com",
    projectId: "ybeauty-f45b6",
    storageBucket: "ybeauty-f45b6.appspot.com",
    messagingSenderId: "854762032933",
    appId: "1:854762032933:web:8c0004ca975950761294cc"
  };
  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);

  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  // ====== DATA: Products ======
  const perfume = Array.from({length:8},(_,i)=>({id:`p${i+1}`, name:`Parfyum ${i+1}`, price: 90000 + i*5000, img:`https://picsum.photos/seed/perf${i}/400/300`, desc:"Nozik gul notalari, kundalik va kechki chiqishlar uchun mos."}));
  const cosmetics = Array.from({length:8},(_,i)=>({id:`c${i+1}`, name:`Kosmetika ${i+1}`, price: 45000 + i*4000, img:`https://picsum.photos/seed/cos${i}/400/300`, desc:"Yuz terisini asraydigan, allergiyasiz, kundalik foydalanishga mos."}));
  const sales = Array.from({length:8},(_,i)=>({id:`s${i+1}`, name:`Chegirma ${i+1}`, price: 30000 + i*3000, img:`https://picsum.photos/seed/sal${i}/400/300`, desc:"Cheklangan aksiya! Sifatli mahsulotga yoqimli narx."}));

  function money(n){ return n.toLocaleString('uz-UZ')+" soâ€˜m"; }

  function renderCards(containerId, items){
    const wrap = document.getElementById(containerId);
    wrap.innerHTML = items.map(p=>`
      <div class="card" data-id="${p.id}" data-name="${p.name}" data-price="${p.price}" data-img="${p.img}" data-desc="${p.desc}">
        <img src="${p.img}" alt="${p.name}" loading="lazy"/>
        <div class="body">
          <p class="title">${p.name}</p>
          <div class="row"><span class="price">${money(p.price)}</span><span class="pill">Yangi</span></div>
        </div>
      </div>
    `).join('');
  }

  function renderMini(containerId, items){
    const el = document.getElementById(containerId);
    el.innerHTML = items.slice(0,6).map(p=>`
      <div class="card" style="min-width:160px" data-id="${p.id}" data-name="${p.name}" data-price="${p.price}" data-img="${p.img}" data-desc="${p.desc}">
        <img src="${p.img}" alt="${p.name}" loading="lazy"/>
        <div class="body">
          <p class="title" style="font-size:13px">${p.name}</p>
          <div class="price">${money(p.price)}</div>
        </div>
      </div>
    `).join('');
  }

  renderMini('mini-new', [...perfume, ...cosmetics]);
  renderCards('perfume-grid', perfume);
  renderCards('cosmetics-grid', cosmetics);
  renderCards('sales-grid', sales);
  renderCards('home-grid', [...perfume.slice(0,4),...cosmetics.slice(0,4)]);

  const sections = ["home","perfume","cosmetics","sale","admin"];
  function showSection(id){
    sections.forEach(s=>{
      const el = document.getElementById(s);
      if(el) el.classList.toggle('active', s===id);
    });
    $$(".nav-link").forEach(b=>b.classList.toggle('active', b.dataset.target===id));
    window.scrollTo({top:0,behavior:'smooth'});
  }

  $$(".nav-link").forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.preventDefault();
      showSection(btn.dataset.target);
    });
  });

  $("#adminBtn").addEventListener('click', ()=>showSection('admin'));

  // Slider
  const slider = $("#slides");
  let idx = 0;
  const total = slider.children.length;
  setInterval(()=>{
    idx = (idx+1)%total;
    slider.style.transform = `translateX(-${idx*100}%)`;
  }, 3000);

  // Modal
  const modal = $("#productModal");
  const modalImg = $("#mImg");
  const modalName = $("#mName");
  const modalDesc = $("#mDesc");
  const modalPrice = $("#mPrice");
  let selectedProduct = null;

  function openProduct(cardEl){
    const p = {
      id: cardEl.dataset.id,
      name: cardEl.dataset.name,
      price: Number(cardEl.dataset.price),
      img: cardEl.dataset.img,
      desc: cardEl.dataset.desc
    };
    selectedProduct = p;
    modalImg.src = p.img;
    modalName.textContent = p.name;
    modalDesc.textContent = p.desc;
    modalPrice.textContent = money(p.price);
    modal.classList.add('open');
  }
  function closeProduct(){ modal.classList.remove('open'); }

  document.addEventListener('click', (e)=>{
    const card = e.target.closest('.card');
    if(card && card.dataset.id){ openProduct(card); }
  });
  $("#closeModal").addEventListener('click', closeProduct);
  modal.addEventListener('click', e=>{ if(e.target===modal) closeProduct(); });

  // BUYURTMA
  $("#orderForm").addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(!selectedProduct){ return; }
    const data = {
      sana: new Date().toLocaleString('uz-UZ'),
      ism: $("#fName").value.trim(),
      tel: $("#fPhone").value.trim(),
      manzil: $("#fAddr").value.trim(),
      mahsulot: selectedProduct.name,
      narx: selectedProduct.price,
      sotildi:false
    };
    if(!data.ism || !data.tel || !data.manzil){
      alert("Iltimos, barcha maydonlarni toâ€˜ldiring.");
      return;
    }
    await push(ref(db,'orders'), data);
    alert("âœ… Buyurtma yuborildi!");
    e.target.reset();
    closeProduct();
  });

  // ===== ADMIN PANEL =====
  const adminSearch = $("#adminSearch");
  let allOrders = {};

  $("#loadBtn").addEventListener('click', ()=>{
    const key = $("#adminKey").value.trim();
    if(key !== 'aass2617'){ alert("âŒ Notoâ€˜gâ€˜ri parol!"); return; }

    $("#adminLogin").style.display = "none";
    $("#adminContent").style.display = "block";

    const ordersRef = ref(db,'orders');
    onValue(ordersRef, (snap)=>{
      allOrders = snap.val() || {};
      renderAdminOrders();
    });
  });

  function renderAdminOrders(query=''){
    const tbody = $("#ordersBody");
    tbody.innerHTML = '';

    let totalOrders=0, totalSum=0, soldCount=0, unsoldCount=0;

    Object.entries(allOrders).reverse().forEach(([id,o])=>{
      const searchable = (o.mahsulot||'').toLowerCase() + ' ' + (o.ism||'').toLowerCase();
      if(!searchable.includes(query.toLowerCase())) return;

      totalOrders++;
      totalSum += Number(o.narx||0);
      if(o.sotildi){ soldCount++; } else { unsoldCount++; }

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${o.sana||''}</td>
        <td>${o.ism||''}</td>
        <td>${o.tel||''}</td>
        <td>${o.manzil||''}</td>
        <td>${o.mahsulot||''}</td>
        <td>${o.narx?money(Number(o.narx)):'-'}</td>
        <td>
          <input type="checkbox" ${o.sotildi?"checked":""} data-id="${id}" class="soldChk"/>
          <button class="delBtn" data-id="${id}" style="margin-left:6px;background:#ff4d6d;color:#fff;padding:2px 6px;border:none;border-radius:6px;cursor:pointer">Oâ€˜chirish</button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    $("#totalOrders").textContent = totalOrders;
    $("#totalSum").textContent = money(totalSum);
    $("#soldCount").textContent = soldCount;
    $("#unsoldCount").textContent = unsoldCount;

    $$(".soldChk").forEach(chk=>{
      chk.addEventListener('change', async ()=>{
        const id = chk.dataset.id;
        const isSold = chk.checked;
        await set(ref(db,'orders/'+id), { ...allOrders[id], sotildi:isSold });
      });
    });

    $$(".delBtn").forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const id = btn.dataset.id;
        if(confirm("Siz rostdan ham ushbu buyurtmani oâ€˜chirmoqchimisiz?")){
          await set(ref(db,'orders/'+id), null);
        }
      });
    });
  }

  adminSearch?.addEventListener('input', ()=>{
    renderAdminOrders(adminSearch.value.trim());
  });

  // Back button
  $$(".back-btn").forEach(btn=>{
    btn.addEventListener('click', ()=>showSection('home'));
  });
</script>
</head>

<body>

<header class="header">
  <div class="header-left">
    <div class="logo">YBeauty</div>
    <div class="searchbar">
      <input type="text" placeholder="Mahsulot qidirish..." />
    </div>
  </div>
  <button id="adminBtn" class="icon-btn" title="Admin">ðŸ‘¤</button>
</header>

<nav class="navbar">
  <button class="nav-link" data-target="perfume">Parfyumeriya</button>
  <button class="nav-link" data-target="cosmetics">Kosmetika</button>
  <button class="nav-link" data-target="sale">Aksiyalar</button>
</nav>

<section id="home" class="section active">
  <div class="slider">
    <div id="slides" class="slides">
      <img src="https://picsum.photos/id/1011/1000/400"/>
      <img src="https://picsum.photos/id/1005/1000/400"/>
      <img src="https://picsum.photos/id/1018/1000/400"/>
    </div>
  </div>
  <h3 class="section-title">Yangi mahsulotlar</h3>
  <div id="mini-new" class="mini"></div>
  <h3 class="section-title">Eng sara tanlov</h3>
  <div id="home-grid" class="grid"></div>
</section>

<section id="perfume" class="section">
  <h3 class="section-title">Parfyumeriya</h3>
  <div id="perfume-grid" class="grid"></div>
</section>

<section id="cosmetics" class="section">
  <h3 class="section-title">Kosmetika</h3>
  <div id="cosmetics-grid" class="grid"></div>
</section>

<section id="sale" class="section">
  <h3 class="section-title">Aksiyalar</h3>
  <div id="sales-grid" class="grid"></div>
</section>

<section id="admin" class="section">
  <h3 class="section-title">Admin panel</h3>
  
  <!-- Parol -->
  <div id="adminLogin">
    <input id="adminKey" class="input" type="password" placeholder="Admin parol"/>
    <button id="loadBtn" class="btn btn-primary">Kirish</button>
  </div>

  <!-- Kontent -->
  <div id="adminContent" style="display:none">
    <input id="adminSearch" class="input" type="text" placeholder="Qidirish..." style="margin:10px 0"/>
    <div class="stats">
      <div class="stat"><h4>Umumiy buyurtma</h4><p id="totalOrders">0</p></div>
      <div class="stat"><h4>Jami summa</h4><p id="totalSum">0</p></div>
      <div class="stat"><h4>Sotilgan</h4><p id="soldCount">0</p></div>
      <div class="stat"><h4>Sotilmagan</h4><p id="unsoldCount">0</p></div>
    </div>
    <div class="admin-wrap">
      <table>
        <thead>
          <tr>
            <th>Sana</th><th>Ism</th><th>Tel</th><th>Manzil</th><th>Mahsulot</th><th>Narx</th><th>Sotildi</th>
          </tr>
        </thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- MODAL -->
<div id="productModal" class="modal">
  <div class="modal-card">
    <img id="mImg" class="modal-media" src="" alt=""/>
    <div class="modal-body">
      <div class="row">
        <h3 id="mName"></h3>
        <button id="closeModal" class="icon-btn">âœ–</button>
      </div>
      <p id="mDesc" class="muted"></p>
      <div class="row">
        <span id="mPrice" class="price"></span>
      </div>
      <form id="orderForm" class="form">
        <input id="fName" class="input" type="text" placeholder="Ismingiz" required/>
        <input id="fPhone" class="input" type="tel" placeholder="Telefon raqam" required/>
        <input id="fAddr" class="input" type="text" placeholder="Manzil" required/>
        <button type="submit" class="btn btn-primary">Buyurtma berish</button>
      </form>
    </div>
  </div>
</div>

</body>
</html>
